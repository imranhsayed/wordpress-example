<?php
/**
 * Component: Accordion
 *
 * @component Accordion
 * @description Expandable/collapsible content sections.
 * @group Layout
 * @props {
 *   "items": {
 *     "type": "array",
 *     "required": true,
 *     "description": "Array of accordion items. Each item should have 'title', 'content', and optional 'open_by_default'."
 *   },
 *   "id": {
 *     "type": "string",
 *     "description": "Unique accordion ID (optional, autogenerated if omitted)"
 *   }
 * }
 * @variations {
 *   "faq": {
 *     "items": [
 *       {
 *         "title": "What payment methods do you accept?",
 *         "content": "<p>We accept all major credit cards, UPI, and net banking.</p>",
 *         "open_by_default": true
 *       },
 *       {
 *         "title": "Can I cancel my order?",
 *         "content": "<p>Yes, you can cancel anytime before itâ€™s shipped.</p>"
 *       },
 *       {
 *         "title": "Do you offer international shipping?",
 *         "content": "<p>Yes, we ship to over 50 countries worldwide.</p>"
 *       }
 *     ]
 *   }
 * }
 * @extra_allowed_tags {
 *   "button": { "aria-expanded": true, "aria-controls": true, "id": true, "class": true },
 *   "div": { "id": true, "role": true, "aria-labelledby": true, "class": true },
 *   "h3": { "class": true },
 *   "svg": { "viewBox": true, "fill": true, "aria-hidden": true, "xmlns": true, "class": true },
 *   "path": { "fill-rule": true, "clip-rule": true, "d": true }
 * }
 * @example render_component('accordion', [
 *   'items' => [
 *     [ 'title' => 'FAQ 1', 'content' => 'Answer 1', 'open_by_default' => true ],
 *     [ 'title' => 'FAQ 2', 'content' => 'Answer 2' ]
 *   ]
 * ])
 *
 * @package Components
 */

if ( empty( $args['items'] ) || ! is_array( $args['items'] ) ) {
	return;
}

$accordion_id = $args['id'] ?? 'accordion-' . wp_rand();
?>

<div class="accordion" id="<?php echo esc_attr( $accordion_id ); ?>">
	<?php foreach ( $args['items'] as $index => $item ) :
		$item_id = $accordion_id . '-item-' . $index;
		$button_id = $item_id . '-button';
		$panel_id = $item_id . '-panel';
		$is_open = ! empty( $item['open_by_default'] );

		$title = esc_html( $item['title'] ?? '' );
		$content = $item['content'] ?? '';
	?>
	<div class="accordion__item">
		<h3 class="accordion__header">
			<button
				id="<?php echo esc_attr( $button_id ); ?>"
				class="accordion__trigger"
				aria-expanded="<?php echo $is_open ? 'true' : 'false'; ?>"
				aria-controls="<?php echo esc_attr( $panel_id ); ?>"
			>
				<?php echo $title; ?>
				<svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
					<path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.292l3.71-4.06a.75.75 0 111.08 1.04l-4.25 4.65a.75.75 0 01-1.08 0l-4.25-4.65a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
				</svg>
			</button>
		</h3>
		<div
			id="<?php echo esc_attr( $panel_id ); ?>"
			role="region"
			class="accordion__panel"
			aria-labelledby="<?php echo esc_attr( $button_id ); ?>"
			<?php echo $is_open ? '' : 'hidden'; ?>
		>
			<?php echo wp_kses_post( $content ); ?>
		</div>
	</div>
	<?php endforeach; ?>
</div>
