(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,a=window.wp.blockEditor,l=window.wp.components,i=window.wp.i18n,s=window.wp.serverSideRender;var n=e.n(s);const o=window.wp.data,r=window.wp.coreData,c=window.wp.apiFetch;var d=e.n(c);const u=window.wp.element,m=window.ReactJSXRuntime;function h({disabled:e,items:t,loading:a,selected:s,onSelected:n}){const o=["aquila-relationship__items","aquila-relationship__items--search",a?"aquila-relationship__items--loading":"",e?"aquila-relationship__items--disabled":""].filter(Boolean).join(" ");return(0,m.jsxs)("ul",{className:o,children:[a&&(0,m.jsx)(l.Spinner,{}),t.map(e=>{const t=s.find(t=>t.id===e.id),a=["aquila-relationship__item",t?"aquila-relationship__item--selected":""].filter(Boolean).join(" "),o=()=>{t||n(e)};return(0,m.jsxs)("li",{className:a,tabIndex:0,onClick:o,onKeyPress:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o())},children:[(0,m.jsx)("div",{className:"aquila-relationship__item-label",children:""!==e.label?e.label:(0,i.__)("(no title)","aquila-theme")}),(0,m.jsx)("div",{className:"aquila-relationship__item-action",children:(0,m.jsx)(l.Icon,{icon:"arrow-right-alt2"})})]},e.id)})]})}function _({items:e,onUnselected:t}){return(0,m.jsx)("ul",{className:"aquila-relationship__items",children:e.map((e,a)=>(0,m.jsxs)("li",{className:"aquila-relationship__item",children:[(0,m.jsx)("div",{className:"aquila-relationship__item-label",children:""!==e.label?e.label:(0,i.__)("(no title)","aquila-theme")}),(0,m.jsx)("div",{className:"aquila-relationship__item-action",children:(0,m.jsx)(l.Tooltip,{text:(0,i.__)("Remove","aquila-theme"),children:(0,m.jsx)(l.Button,{onClick:()=>t(e),icon:"dismiss"})})})]},e.id||a))})}let p=null;function x({maxItems:e,onSelect:t,items:a,searchQuery:l}){const[s,n]=(0,u.useState)([]),[o,r]=(0,u.useState)(!1);(0,u.useEffect)(()=>{c()},[]);const c=(e="")=>{r(!0),l(e).then(e=>{r(!1),n(e)})};return(0,m.jsxs)("div",{className:"aquila-relationship",children:[(0,m.jsx)("div",{className:"aquila-relationship__search-container",children:(0,m.jsx)("input",{type:"text",className:"aquila-relationship__search",placeholder:(0,i.__)("Search","aquila-theme"),onChange:e=>{clearTimeout(p),p=setTimeout(c,300,e.target.value)}})}),(0,m.jsxs)("div",{className:"aquila-relationship__panel",children:[(0,m.jsx)("div",{className:"aquila-relationship__panel__search-items",children:(0,m.jsx)(h,{disabled:e>0&&a.length>=e,items:s,loading:o,selected:a,onSelected:e=>t([...a,e])})}),(0,m.jsx)("div",{className:"aquila-relationship__panel__selected-items",children:(0,m.jsx)(_,{items:a,onUpdated:e=>t(e),onUnselected:e=>t(a.filter(t=>t.value!==e.value))})})]})]})}function q({initialItems:e=[],label:t,searchQuery:a,help:s,buttonLabel:n=(0,i.__)("Select Posts","aquila-theme"),modalTitle:o=(0,i.__)("Select Posts","aquila-theme"),minimal:r=!1,max:c=-1,onSelect:d}){const[h,_]=(0,u.useState)([]),[p,q]=(0,u.useState)([]),[b,j]=(0,u.useState)(!0),[y,g]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{_(e),j(!1)},[e]),(0,m.jsxs)(l.BaseControl,{id:"aquila-relationship-control",label:t,help:s,className:"aquila-relationship",children:[(0,m.jsx)(l.Button,{variant:"secondary",isBusy:r&&b,onClick:()=>{q(h),g(!0)},children:n}),!r&&h.length>0&&(0,m.jsxs)("ul",{className:"aquila-relationship__selected-items"+(b?" aquila-relationship__selected-items--loading":""),children:[b&&(0,m.jsx)("li",{children:(0,m.jsx)(l.Spinner,{})}),!b&&h.length>0&&h.map((e,t)=>3===t?(0,m.jsxs)("li",{children:["... ",h.length-3," ",(0,i.__)("more","aquila-theme")]},4):t>3?null:(0,m.jsxs)("li",{children:["âœ“ ",e.label]},t))]}),y&&(0,m.jsxs)(l.Modal,{title:o,className:"aquila-relationship__modal",onRequestClose:()=>g(!1),children:[(0,m.jsx)(x,{maxItems:c,onSelect:e=>q(e),items:p,searchQuery:a}),(0,m.jsx)("div",{className:"aquila-relationship__modal__actions",children:(0,m.jsx)(l.Button,{variant:"primary",onClick:()=>{_(p),g(!1),d&&d(p.map(e=>e.value))},children:(0,i.__)("Select","aquila-theme")})})]})]})}function b({selectedPosts:e=[],onChange:t,postType:a="post",maxPosts:l=20,label:s=(0,i.__)("Posts","aquila-theme"),buttonLabel:n=(0,i.__)("Select Posts","aquila-theme"),modalTitle:c=(0,i.__)("Select Posts","aquila-theme")}){const u=(0,o.useSelect)(t=>e&&0!==e.length?e.map(e=>{const l=t(r.store).getEntityRecord("postType",a,e);return l?{id:l.id,value:l.id,label:l.title.rendered||(0,i.__)("(no title)","aquila-theme")}:null}).filter(Boolean):[],[e,a]);return(0,m.jsx)(q,{initialItems:u,label:s,searchQuery:(e="")=>new Promise(t=>{const l="post"===a?"posts":a+"s",s=e?`&search=${encodeURIComponent(e)}`:"";d()({path:`/wp/v2/${l}?per_page=20&_fields=id,title${s}`}).then(e=>{const a=e.map(e=>({id:e.id,value:e.id,label:e.title.rendered||(0,i.__)("(no title)","aquila-theme")}));t(a)}).catch(()=>{t([])})}),buttonLabel:n,modalTitle:c,max:l,onSelect:t})}function j({attributes:e,setAttributes:t}){const{mode:s="automatic",selectedPosts:n=[],categoryId:c,order:d="asc",orderBy:u="title",numberOfItems:h=4}=e,_=(0,o.useSelect)(e=>e(r.store).getEntityRecords("taxonomy","category",{per_page:-1,hide_empty:!1}),[]);return(0,m.jsxs)(a.InspectorControls,{children:[(0,m.jsx)(l.PanelBody,{title:(0,i.__)("Settings","aquila-theme"),children:(0,m.jsx)(l.SelectControl,{label:(0,i.__)("Display Mode","aquila-theme"),value:s,options:[{label:(0,i.__)("Automatic","aquila-theme"),value:"automatic"},{label:(0,i.__)("Manual","aquila-theme"),value:"manual"}],onChange:e=>{t({mode:e})},help:"automatic"===s?(0,i.__)("Automatically fetch latest posts based on criteria below","aquila-theme"):(0,i.__)("Manually select posts to display","aquila-theme")})}),"automatic"===s&&(0,m.jsx)(l.PanelBody,{title:(0,i.__)("Query Settings","aquila-theme"),children:(0,m.jsx)(l.QueryControls,{categoriesList:_,selectedCategoryId:c,onCategoryChange:e=>{t(e?{categoryId:parseInt(e,10)}:{categoryId:0})},order:d,orderBy:u,onOrderChange:e=>t({order:e}),onOrderByChange:e=>t({orderBy:e}),numberOfItems:h,onNumberOfItemsChange:e=>t({numberOfItems:e})})}),"manual"===s&&(0,m.jsx)(l.PanelBody,{title:(0,i.__)("Manual Selection","aquila-theme"),initialOpen:!0,children:(0,m.jsx)(b,{selectedPosts:n,onChange:e=>{t({selectedPosts:e})},postType:"post",maxPosts:20,label:"",buttonLabel:(0,i.__)("Select Posts","aquila-theme"),modalTitle:(0,i.__)("Select Posts","aquila-theme")})})]})}const y=JSON.parse('{"UU":"aquila/related-articles"}');(0,t.registerBlockType)(y.UU,{edit:function({attributes:e,setAttributes:t}){const{mode:s="automatic",selectedPosts:o=[]}=e,r=(0,a.useBlockProps)({className:"related-articles-block alignfull"}),c="manual"===s&&0===o.length;return(0,m.jsxs)("div",{...r,children:[(0,m.jsx)(j,{attributes:e,setAttributes:t}),c?(0,m.jsx)(l.Placeholder,{icon:"grid-view",label:(0,i.__)("Related Articles","aquila-theme"),instructions:(0,i.__)("Select posts from the block settings to display them here.","aquila-theme")}):(0,m.jsx)(n(),{block:"aquila/related-articles",attributes:e})]})}})})();