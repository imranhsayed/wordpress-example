(function() {
'use strict';
const { registerBlockType: O } = wp.blocks;const { jsxs: u, jsx: e } = ReactJSXRuntime;const { InspectorControls: w, useBlockProps: T } = wp.blockEditor;const { Spinner: P, Icon: $, Tooltip: x, Button: b, BaseControl: j, Modal: E, PanelBody: N, SelectControl: Q, QueryControls: U, Placeholder: D } = wp.components;const { __: t } = wp.i18n;const L = wp.serverSideRender;const { useSelect: B } = wp.data;const { store: k } = wp.coreData;const F = wp.apiFetch;const { useState: q, useEffect: R } = wp.element;function z({disabled:n,items:i,loading:l,selected:c,onSelected:m}){const h=["aquila-relationship__items","aquila-relationship__items--search",l?"aquila-relationship__items--loading":"",n?"aquila-relationship__items--disabled":""].filter(Boolean).join(" ");return u("ul",{className:h,children:[l&&e(P,{}),i.map(s=>{const d=c.find(a=>a.id===s.id),p=["aquila-relationship__item",d?"aquila-relationship__item--selected":""].filter(Boolean).join(" ");return u("li",{className:p,onClick:()=>{d||m(s)},children:[e("div",{className:"aquila-relationship__item-label",children:s.label!==""?s.label:t("(no title)","aquila-theme")}),e("div",{className:"aquila-relationship__item-action",children:e($,{icon:"arrow-right-alt2"})})]},s.id)})]})}function G({items:n,onUnselected:i}){return e("ul",{className:"aquila-relationship__items",children:n.map((l,c)=>u("li",{className:"aquila-relationship__item",children:[e("div",{className:"aquila-relationship__item-label",children:l.label!==""?l.label:t("(no title)","aquila-theme")}),e("div",{className:"aquila-relationship__item-action",children:e(x,{text:t("Remove","aquila-theme"),children:e(b,{onClick:()=>i(l),icon:"dismiss"})})})]},l.id||c))})}const H=300;let I=null;function J({maxItems:n,onSelect:i,items:l,searchQuery:c}){const[m,h]=q([]),[s,d]=q(!1);R(()=>{a()},[]);const p=o=>{clearTimeout(I),I=setTimeout(a,H,o.target.value)},a=(o="")=>{d(!0),c(o).then(r=>{d(!1),h(r)})};return u("div",{className:"aquila-relationship",children:[e("div",{className:"aquila-relationship__search-container",children:e("input",{type:"text",className:"aquila-relationship__search",placeholder:t("Search","aquila-theme"),onChange:p})}),u("div",{className:"aquila-relationship__panel",children:[e("div",{className:"aquila-relationship__panel__search-items",children:e(z,{disabled:n>0&&l.length>=n,items:m,loading:s,selected:l,onSelected:o=>i([...l,o])})}),e("div",{className:"aquila-relationship__panel__selected-items",children:e(G,{items:l,onUpdated:o=>i(o),onUnselected:o=>i(l.filter(r=>r.value!==o.value))})})]})]})}function K({initialItems:n=[],label:i,searchQuery:l,help:c,buttonLabel:m=t("Select Posts","aquila-theme"),modalTitle:h=t("Select Posts","aquila-theme"),minimal:s=!1,max:d=-1,onSelect:p}){const[a,o]=q([]),[r,y]=q([]),[_,S]=q(!0),[f,v]=q(!1);R(()=>{o(n),S(!1)},[n]);const M=()=>{o(r),v(!1),p&&p(r.map(g=>g.value))};return u(j,{label:i,help:c,className:"aquila-relationship",children:[e(b,{variant:"secondary",isBusy:s&&_,onClick:()=>{y(a),v(!0)},children:m}),!s&&a.length>0&&u("ul",{className:`aquila-relationship__selected-items${_?" aquila-relationship__selected-items--loading":""}`,children:[_&&e("li",{children:e(P,{})}),!_&&a.length>0&&a.map((g,C)=>C===3?u("li",{children:["... ",a.length-3," ",t("more","aquila-theme")]},4):C>3?null:u("li",{children:["âœ“ ",g.label]},C))]}),f&&u(E,{title:h,className:"aquila-relationship__modal",onRequestClose:()=>v(!1),children:[e(J,{maxItems:d,onSelect:g=>y(g),items:r,searchQuery:l}),e("div",{className:"aquila-relationship__modal__actions",children:e(b,{variant:"primary",onClick:M,children:t("Select","aquila-theme")})})]})]})}function V({selectedPosts:n=[],onChange:i,postType:l="post",maxPosts:c=20,label:m=t("Posts","aquila-theme"),buttonLabel:h=t("Select Posts","aquila-theme"),modalTitle:s=t("Select Posts","aquila-theme")}){const d=B(a=>!n||n.length===0?[]:n.map(o=>{const r=a(k).getEntityRecord("postType",l,o);return r?{id:r.id,value:r.id,label:r.title.rendered||t("(no title)","aquila-theme")}:null}).filter(Boolean),[n,l]);return e(K,{initialItems:d,label:m,searchQuery:(a="")=>new Promise(o=>{const r=l==="post"?"posts":l+"s",y=a?`&search=${encodeURIComponent(a)}`:"";F({path:`/wp/v2/${r}?per_page=20&_fields=id,title${y}`}).then(_=>{const S=_.map(f=>({id:f.id,value:f.id,label:f.title.rendered||t("(no title)","aquila-theme")}));o(S)}).catch(()=>{o([])})}),buttonLabel:h,modalTitle:s,max:c,onSelect:i})}function W({attributes:n,setAttributes:i}){const{mode:l="automatic",selectedPosts:c=[],categoryId:m,order:h="asc",orderBy:s="title",numberOfItems:d=4}=n,p=B(a=>{const o={per_page:-1,hide_empty:!1};return a(k).getEntityRecords("taxonomy","category",o)},[]);return u(w,{children:[e(N,{title:t("Settings","aquila-theme"),children:e(Q,{label:t("Display Mode","aquila-theme"),value:l,options:[{label:t("Automatic","aquila-theme"),value:"automatic"},{label:t("Manual","aquila-theme"),value:"manual"}],onChange:a=>{i({mode:a})},help:l==="automatic"?t("Automatically fetch latest posts based on criteria below","aquila-theme"):t("Manually select posts to display","aquila-theme")})}),l==="automatic"&&e(N,{title:t("Query Settings","aquila-theme"),children:e(U,{categoriesList:p,selectedCategoryId:m,onCategoryChange:a=>{if(!a){i({categoryId:0});return}i({categoryId:parseInt(a,10)})},order:h,orderBy:s,onOrderChange:a=>i({order:a}),onOrderByChange:a=>i({orderBy:a}),numberOfItems:d,onNumberOfItemsChange:a=>i({numberOfItems:a})})}),l==="manual"&&e(N,{title:t("Manual Selection","aquila-theme"),initialOpen:!0,children:e(V,{selectedPosts:c,onChange:a=>{i({selectedPosts:a})},postType:"post",maxPosts:20,label:"",buttonLabel:t("Select Posts","aquila-theme"),modalTitle:t("Select Posts","aquila-theme")})})]})}function X({attributes:n,setAttributes:i}){const l="related-articles-block",{mode:c="automatic",selectedPosts:m=[]}=n,h=T({className:`${l} alignfull`}),s=c==="manual"&&m.length===0;return u("div",{...h,children:[e(W,{attributes:n,setAttributes:i}),s?e(D,{icon:"grid-view",label:t("Related Articles","aquila-theme"),instructions:t("Select posts from the block settings to display them here.","aquila-theme")}):e(L,{block:"aquila/related-articles",attributes:n})]})}const Y="aquila/related-articles",Z={name:Y};O(Z.name,{edit:X});

})();