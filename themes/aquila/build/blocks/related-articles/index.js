(function() {
'use strict';
const { registerBlockType: O } = wp.blocks;const { jsxs: u, jsx: a } = ReactJSXRuntime;const { InspectorControls: w, useBlockProps: x } = wp.blockEditor;const { Spinner: P, Icon: T, Tooltip: $, Button: N, BaseControl: E, Modal: j, PanelBody: b, SelectControl: D, QueryControls: Q, Placeholder: U } = wp.components;const { __: i } = wp.i18n;const L = wp.serverSideRender;const { useSelect: B } = wp.data;const { store: k } = wp.coreData;const F = wp.apiFetch;const { useState: q, useEffect: R } = wp.element;function K({disabled:o,items:n,loading:l,selected:c,onSelected:m}){const h=["aquila-relationship__items","aquila-relationship__items--search",l?"aquila-relationship__items--loading":"",o?"aquila-relationship__items--disabled":""].filter(Boolean).join(" ");return u("ul",{className:h,children:[l&&a(P,{}),n.map(s=>{const d=c.find(t=>t.id===s.id),p=["aquila-relationship__item",d?"aquila-relationship__item--selected":""].filter(Boolean).join(" "),e=()=>{d||m(s)};return u("li",{className:p,tabIndex:0,onClick:e,onKeyPress:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e())},children:[a("div",{className:"aquila-relationship__item-label",children:s.label!==""?s.label:i("(no title)","aquila-theme")}),a("div",{className:"aquila-relationship__item-action",children:a(T,{icon:"arrow-right-alt2"})})]},s.id)})]})}function z({items:o,onUnselected:n}){return a("ul",{className:"aquila-relationship__items",children:o.map((l,c)=>u("li",{className:"aquila-relationship__item",children:[a("div",{className:"aquila-relationship__item-label",children:l.label!==""?l.label:i("(no title)","aquila-theme")}),a("div",{className:"aquila-relationship__item-action",children:a($,{text:i("Remove","aquila-theme"),children:a(N,{onClick:()=>n(l),icon:"dismiss"})})})]},l.id||c))})}const G=300;let I=null;function H({maxItems:o,onSelect:n,items:l,searchQuery:c}){const[m,h]=q([]),[s,d]=q(!1);R(()=>{e()},[]);const p=t=>{clearTimeout(I),I=setTimeout(e,G,t.target.value)},e=(t="")=>{d(!0),c(t).then(r=>{d(!1),h(r)})};return u("div",{className:"aquila-relationship",children:[a("div",{className:"aquila-relationship__search-container",children:a("input",{type:"text",className:"aquila-relationship__search",placeholder:i("Search","aquila-theme"),onChange:p})}),u("div",{className:"aquila-relationship__panel",children:[a("div",{className:"aquila-relationship__panel__search-items",children:a(K,{disabled:o>0&&l.length>=o,items:m,loading:s,selected:l,onSelected:t=>n([...l,t])})}),a("div",{className:"aquila-relationship__panel__selected-items",children:a(z,{items:l,onUpdated:t=>n(t),onUnselected:t=>n(l.filter(r=>r.value!==t.value))})})]})]})}function J({initialItems:o=[],label:n,searchQuery:l,help:c,buttonLabel:m=i("Select Posts","aquila-theme"),modalTitle:h=i("Select Posts","aquila-theme"),minimal:s=!1,max:d=-1,onSelect:p}){const[e,t]=q([]),[r,y]=q([]),[_,S]=q(!0),[f,v]=q(!1);R(()=>{t(o),S(!1)},[o]);const M=()=>{t(r),v(!1),p&&p(r.map(g=>g.value))};return u(E,{id:"aquila-relationship-control",label:n,help:c,className:"aquila-relationship",children:[a(N,{variant:"secondary",isBusy:s&&_,onClick:()=>{y(e),v(!0)},children:m}),!s&&e.length>0&&u("ul",{className:`aquila-relationship__selected-items${_?" aquila-relationship__selected-items--loading":""}`,children:[_&&a("li",{children:a(P,{})}),!_&&e.length>0&&e.map((g,C)=>C===3?u("li",{children:["... ",e.length-3," ",i("more","aquila-theme")]},4):C>3?null:u("li",{children:["âœ“ ",g.label]},C))]}),f&&u(j,{title:h,className:"aquila-relationship__modal",onRequestClose:()=>v(!1),children:[a(H,{maxItems:d,onSelect:g=>y(g),items:r,searchQuery:l}),a("div",{className:"aquila-relationship__modal__actions",children:a(N,{variant:"primary",onClick:M,children:i("Select","aquila-theme")})})]})]})}function V({selectedPosts:o=[],onChange:n,postType:l="post",maxPosts:c=20,label:m=i("Posts","aquila-theme"),buttonLabel:h=i("Select Posts","aquila-theme"),modalTitle:s=i("Select Posts","aquila-theme")}){const d=B(e=>!o||o.length===0?[]:o.map(t=>{const r=e(k).getEntityRecord("postType",l,t);return r?{id:r.id,value:r.id,label:r.title.rendered||i("(no title)","aquila-theme")}:null}).filter(Boolean),[o,l]);return a(J,{initialItems:d,label:m,searchQuery:(e="")=>new Promise(t=>{const r=l==="post"?"posts":l+"s",y=e?`&search=${encodeURIComponent(e)}`:"";F({path:`/wp/v2/${r}?per_page=20&_fields=id,title${y}`}).then(_=>{const S=_.map(f=>({id:f.id,value:f.id,label:f.title.rendered||i("(no title)","aquila-theme")}));t(S)}).catch(()=>{t([])})}),buttonLabel:h,modalTitle:s,max:c,onSelect:n})}function W({attributes:o,setAttributes:n}){const{mode:l="automatic",selectedPosts:c=[],categoryId:m,order:h="asc",orderBy:s="title",numberOfItems:d=4}=o,p=B(e=>{const t={per_page:-1,hide_empty:!1};return e(k).getEntityRecords("taxonomy","category",t)},[]);return u(w,{children:[a(b,{title:i("Settings","aquila-theme"),children:a(D,{label:i("Display Mode","aquila-theme"),value:l,options:[{label:i("Automatic","aquila-theme"),value:"automatic"},{label:i("Manual","aquila-theme"),value:"manual"}],onChange:e=>{n({mode:e})},help:l==="automatic"?i("Automatically fetch latest posts based on criteria below","aquila-theme"):i("Manually select posts to display","aquila-theme")})}),l==="automatic"&&a(b,{title:i("Query Settings","aquila-theme"),children:a(Q,{categoriesList:p,selectedCategoryId:m,onCategoryChange:e=>{if(!e){n({categoryId:0});return}n({categoryId:parseInt(e,10)})},order:h,orderBy:s,onOrderChange:e=>n({order:e}),onOrderByChange:e=>n({orderBy:e}),numberOfItems:d,onNumberOfItemsChange:e=>n({numberOfItems:e})})}),l==="manual"&&a(b,{title:i("Manual Selection","aquila-theme"),initialOpen:!0,children:a(V,{selectedPosts:c,onChange:e=>{n({selectedPosts:e})},postType:"post",maxPosts:20,label:"",buttonLabel:i("Select Posts","aquila-theme"),modalTitle:i("Select Posts","aquila-theme")})})]})}function X({attributes:o,setAttributes:n}){const l="related-articles-block",{mode:c="automatic",selectedPosts:m=[]}=o,h=x({className:`${l} alignfull`}),s=c==="manual"&&m.length===0;return u("div",{...h,children:[a(W,{attributes:o,setAttributes:n}),s?a(U,{icon:"grid-view",label:i("Related Articles","aquila-theme"),instructions:i("Select posts from the block settings to display them here.","aquila-theme")}):a(L,{block:"aquila/related-articles",attributes:o})]})}const Y="aquila/related-articles",Z={name:Y};O(Z.name,{edit:X});

})();